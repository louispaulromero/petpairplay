<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pet Pair Play</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" href="styles.css" />
    <script src="bootstrap/js/bootstrap.bundle.js"></script>
    <style>
      /* Add this to keep nav-buttons fixed at the bottom */
      .nav-buttons {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: center;
        background-color: #fff; /* Adjust to match your theme; prevents transparency issues */
        padding: 10px 0;
        z-index: 1000; /* Ensure it stays on top of other content */
      }
      .nav-buttons button {
        margin: 0 10px; /* Spacing between buttons */
      }
      /* Optional: Add padding to body to prevent content overlap with fixed buttons */
      body {
        padding-bottom: 60px; /* Adjust based on button height */
      }
    </style>
  </head>

  <body>
    <div class="container">
      <header class="app-header">
        <div class="logo">
          <img src="./assets/petpairplaylogo.svg" alt="PetPairPlay Logo" class="logo-icon" />
          <span class="logo-text">Pet Pair Play</span>
        </div>
        <div class="header-icons">
          <button class="icon-btn" aria-label="Learn">
            <img src="./assets/education-center.svg" alt="Graduation cap icon for Education Center" />
          </button>
          <button class="icon-btn" aria-label="Notifications">
            <img src="./assets/Notification.svg" alt="Bell icon for Notifications" />
          </button>
          <button class="icon-btn" aria-label="Profile">
            <img src="./assets/profile.svg" alt="User profile icon" />
          </button>
        </div>
      </header>

      <header class="button-header">
        <h1></h1>
        <button class="btn btn-secondary hidden" id="home-button">Back</button>
      </header>

      <div class="home" id="home-page">
        <div class="query">
          <form class="input-group mb-4" id="suggest-form">
            <!-- Sidenav with filters -->
            <div id="mySidenav" class="sidenav">
              <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
              <div class="filters">
                <h1>Filters</h1>
                <a href="#">Location</a>
                <input type="checkbox" id="near" name="near" value="near">
                <label for="near">Near</label> 
                <a href="#">Species</a>
                <input type="checkbox" id="cat" name="cat" value="cat">
                <label for="cat">Cat</label>          
                <input type="checkbox" id="dog" name="dog" value="dog">
                <label for="dog">Dog</label>
                <input type="checkbox" id="rabbit" name="rabbit" value="rabbit">
                <label for="rabbit">Rabbit</label>

                <a href="#">Sex</a>
                <input type="checkbox" id="female" name="female" value="female">
                <label for="female">Female</label>
                <input type="checkbox" id="male" name="male" value="male">
                <label for="male">Male</label>

                <a href="#">Age</a>
                <input type="checkbox" id="baby" name="baby" value="baby">
                <label for="baby">Baby</label>
                <input type="checkbox" id="adult" name="adult" value="adult">
                <label for="adult">Adult</label>
                <input type="checkbox" id="senior" name="senior" value="senior">
                <label for="senior">Senior</label>

                <a href="#">Size</a>
                <input type="checkbox" id="small" name="small" value="small">
                <label for="small">Small</label>
                <input type="checkbox" id="medium" name="medium" value="medium">
                <label for="medium">Medium</label>
                <input type="checkbox" id="large" name="large" value="large">
                <label for="large">Large</label>

                <a href="#">Adoption Fee</a>
                <input type="checkbox" id="free" name="free" value="free">
                <label for="free">$0</label>
                <input type="checkbox" id="under" name="under" value="under">
                <label for="under">Under $20</label>
                <input type="checkbox" id="over" name="over" value="over">
                <label for="over">$20+</label>

                <a href="#">Open to Special Needs</a>
                <input type="checkbox" id="yes" name="yes" value="yes">
                <label for="yes">Yes</label>
                <input type="checkbox" id="no" name="no" value="no">
                <label for="no">No</label>

                <a href="#">Other</a>
                <input type="checkbox" id="hypo" name="hypo" value="hypo">
                <label for="hypo">Hypoallergenic</label>
                <input type="checkbox" id="good-kids" name="good-kids" value="good-kids">
                <label for="good-kids">Good with Kids</label>
                <input type="checkbox" id="good-animals" name="good-animals" value="good-animals">
                <label for="good-animals">Good with Other Animals</label>
              </div>
              <input type="submit" value="Apply Filter">
            </div>

            <span class="me-3" style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776;</span>

            <input
              type="text"
              class="form-control"
              id="query-input"
              placeholder="Describe your home, lifestyle, or what youâ€™re looking for in a rabbit..."
              aria-label="What are you looking for?"
            />
            <button
              class="btn btn-outline-primary"
              type="submit"
              id="suggest-button"
            >
              Help me choose
            </button>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Sidenav functions
      function openNav() {
        document.getElementById("mySidenav").style.width = "250px";
      }

      function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
      }

      // Fetch JSON and dynamically generate rabbit cards and blurbs
      fetch('https://raw.githubusercontent.com/louispaulromero/petpairplay/refs/heads/louis/rabbits.json')
        .then(response => response.json())
        .then(data => {
          console.log('Fetched rabbits:', data.rabbits); // Debug: Log the loaded data
          if (!data.rabbits || data.rabbits.length === 0) {
            console.error('No rabbits found in JSON');
            return;
          }

          const homePage = document.getElementById('home-page');
          const container = document.querySelector('.container');


          data.rabbits.forEach((rabbit, index) => {
            console.log(`Generating card for rabbit ${index + 1}: ${rabbit.card_page.name}`); // Debug each rabbit

            const cardPage = rabbit.card_page;
            const detailsPage = rabbit.details_page;

            const rabbitId = cardPage.name.toLowerCase().replace(/\s+/g, '-');
            const cardButtonId = `${rabbitId}-button`;
            const blurbId = `${rabbitId}-blurb`;

            // Generate primary card
            const card = document.createElement('div');
            card.className = 'card mb-3';
            card.id = cardButtonId;
            card.role = 'button';
            card.innerHTML = `
              <div class="row g-0 align-items-center">
                <div class="col-md-4 text-center">
                  <img src="${cardPage.image}" class="img-fluid rounded-start mt-4" alt="${cardPage.name}" />
                </div>
                <div class="col-md-8 d-flex flex-column justify-content-center">
                  <div class="card-body text-center">
                    <h2 class="card-title">Name: ${cardPage.name}</h2>
                    <p>Sex: ${cardPage.sex}</p>
                    <p>Breed: ${cardPage.breed}</p>
                    <p>Age: ${cardPage.age}</p>
                    <p>Adoption Fee: $${cardPage.adoption_fee}</p>
                  </div>
                </div>
              </div>
            `;
            homePage.appendChild(card);

            // Generate secondary blurb
            const blurb = document.createElement('div');
            blurb.className = 'hidden planet-blurb';
            blurb.id = blurbId;
            blurb.innerHTML = `
              <div class="d-flex flex-column align-items-center justify-content-center h-100 w-100 text-center">
                <div class="planet-image mb-3">
                  <img src="${detailsPage.image}" alt="${cardPage.name}" />
                </div>
                <div class="planet-info">
                  <h2>Name: ${cardPage.name}</h2>

                <div class="secondary-page-buttons-container">
                  <button class="btn btn-link p-0 d-flex flex-column align-items-center" id="learn-button-1" style="font-weight:500; font-size:1.12em; text-decoration:none;">
                    <img src="./assets/dogLeash.svg" alt="Learn" style="height:1.6em; margin-bottom:0.2em;">
                    <span>Learn</span>
                  </button>
                  <button class="btn btn-link p-0 d-flex flex-column align-items-center" id="count-button-2" style="font-weight:500; font-size:1.12em; text-decoration:none;">
                    <img src="./assets/heart.svg" alt="Learn" style="height:1.6em; margin-bottom:0.2em;">
                    <span>Count</span>
                  </button>
                  <button class="btn btn-link p-0 d-flex flex-column align-items-center" id="count-button-3" style="font-weight:500; font-size:1.12em; text-decoration:none;">
                    <img src="./assets/plusMath.svg" alt="Learn" style="height:1.6em; margin-bottom:0.2em;">
                    <span>Save</span>
                  </button>
                </div>


                  <div id="custom-blurb-${rabbitId}"></div>
                  <p>Location: ${detailsPage.location}</p>
                  <p>Distance: ${detailsPage.distance}</p>
                  <p>Sex: ${detailsPage.sex}</p>
                  <p>Breed: ${detailsPage.breed}</p>
                  <p>Weight: ${detailsPage.weight}</p>
                  <p>Age: ${detailsPage.age}</p>
                  <p>Adoption Fee: $${detailsPage.adoption_fee}</p>

                  <div class="mb-3">
                    ${detailsPage.personality_traits.map(
                      trait => `<span class="badge rounded-pill bg-secondary mx-1">${trait}</span>`
                    ).join('')}
                  </div>

                  <p id="pet-biography-dp-${rabbitId}">Biography: Loading...</p>


                  <button class="btn btn-primary mt-3" id="contact-button-${rabbitId}">Contact</button>
                </div>
              </div>
            `;

            container.appendChild(blurb);

            // Optional biography generation (uncomment if needed)
            async function generateBiography() 
            {
                // import fetch from 'node-fetch'; // for node.js

                const response = await fetch(
                  'https://noggin.rea.gent/future-caterpillar-7765',
                  {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                      Authorization: 'Bearer rg_v1_mb2h09h86jochxyjt77y4d03f279aerm63cu_ngk',
                    },
                    body: JSON.stringify({
                      // fill variables here.
                      "trait1": detailsPage.personality_traits[1],
                      "trait2": detailsPage.personality_traits[2],
                      "species": cardPage.species,
                      "breed": cardPage.breed,
                      "name": cardPage.name,
                      "trait0": detailsPage.personality_traits[0],
                    }),
                  }
                ).then(response => response.text());
              document.getElementById("pet-biography-dp-" + rabbitId).innerHTML = "Biography: " + response;

              console.log(response);

            }

            // Click listener
            document.getElementById(cardButtonId).addEventListener('click', () => {
              navigateToBlurb(rabbitId);

              const bioElem = document.getElementById("pet-biography-dp-" + rabbitId);

              if(bioElem && bioElem.innerHTML.includes("Loading...")){
                //generateBiography();
              }
            });
          });
        })
        .catch(error => console.error('Error fetching rabbits.json:', error));

      // Navigation functions
      const navigateToBlurb = (id) => {
        document.querySelectorAll('.planet-blurb').forEach(blurb => blurb.classList.add('hidden'));
        const targetBlurb = document.getElementById(`${id}-blurb`);
        if (targetBlurb) targetBlurb.classList.remove('hidden');
        document.getElementById('home-page').classList.add('hidden');
        document.getElementById('home-button').classList.remove('hidden');
      };

      const navigateHome = () => {
        document.querySelectorAll('.planet-blurb').forEach(blurb => blurb.classList.add('hidden'));
        document.getElementById('home-page').classList.remove('hidden');
        document.getElementById('home-button').classList.add('hidden');

      };

      document.getElementById('home-button').addEventListener('click', navigateHome);

      // Suggest form handler (updated to remove fixed planetNames if not needed)
      document.getElementById('suggest-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        const usersInput = document.querySelector('#query-input').value;
        console.log('User input:', usersInput);

        // Fetch the rabbits JSON first
        const rabbitsResponse = await fetch('https://raw.githubusercontent.com/louispaulromero/petpairplay/refs/heads/louis/rabbits.json');
        const rabbitsData = await rabbitsResponse.json();

        const allRabbits = rabbitsData.rabbits;

// import fetch from 'node-fetch'; // for node.js



const response = await fetch(
  'https://noggin.rea.gent/extensive-duck-2370',
  {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: 'Bearer rg_v1_gp0obuliinf3t4oqldkod8vzqija0ztben9b_ngk',
    },
    body: JSON.stringify({
      // fill variables here.
      "userText": usersInput,
    }),
  }
).then(response => response.text());
        console.log('all rabbits:', allRabbits)
        console.log('Suggestion response:', response);

        // Suppose 'response' is the raw text you get from the AI endpoint
const responseLines = response.trim().split('\n');

// Extract the rabbit name from the first line
const rabbitName = responseLines[0].trim();

// Extract the rest of the response (after the first line)
const rabbitDescription = responseLines.slice(1).join('\n').trim();

// Now you can use these variables:
console.log('Rabbit Name test:', rabbitName);
console.log('Rabbit Description test:', rabbitDescription);

        // If you need dynamic handling here, update based on your JSON (e.g., match to rabbit names)
        // For now, assuming it's for blurbs; adjust as needed
        
        //const responseLines = response.split('\n');
        //const nameCandidate = responseLines[0].trim().toLowerCase().replace(/\s+/g, '-');
        const rabbitId = rabbitName.toLowerCase().replace(/\s+/g, '-');

const blurbElement = document.getElementById(`custom-blurb-${rabbitId}`);

        if (blurbElement) blurbElement.innerHTML = rabbitDescription;
        navigateToBlurb(rabbitId); // Dynamically navigate based on response
        
      });
    </script>
  </body>
</html>
